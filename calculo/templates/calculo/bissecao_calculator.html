{% load static %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ’– Calculadora MÃ©todo da BisseÃ§Ã£o</title>

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap">
    <link rel="stylesheet" href="{% static 'css/bissecao_calculator.css' %}">
</head>

<body>
    <div class="floating-hearts">
        <div class="heart-blink" style="left: 8%; top: 15%; animation-delay: 0s;">ğŸ’–</div>
        <div class="heart-blink" style="left: 22%; top: 25%; animation-delay: 1s;">ğŸ’•</div>
        <div class="heart-blink" style="left: 38%; top: 45%; animation-delay: 2s;">ğŸ’—</div>
        <div class="heart-blink" style="left: 52%; top: 35%; animation-delay: 0.5s;">ğŸ’–</div>
        <div class="heart-blink" style="left: 68%; top: 55%; animation-delay: 1.5s;">ğŸ’•</div>
        <div class="heart-blink" style="left: 82%; top: 65%; animation-delay: 2.5s;">ğŸ’—</div>
        <div class="heart-blink" style="left: 12%; top: 75%; animation-delay: 1.2s;">ğŸ’–</div>
        <div class="heart-blink" style="left: 28%; top: 85%; animation-delay: 0.8s;">ğŸ’•</div>
        <div class="heart-blink" style="left: 48%; top: 20%; animation-delay: 1.8s;">ğŸ’—</div>
        <div class="heart-blink" style="left: 62%; top: 10%; animation-delay: 2.2s;">ğŸ’–</div>
        <div class="heart-blink" style="left: 78%; top: 30%; animation-delay: 0.3s;">ğŸ’•</div>
        <div class="heart-blink" style="left: 92%; top: 50%; animation-delay: 1.3s;">ğŸ’—</div>
        <div class="heart-blink" style="left: 18%; top: 60%; animation-delay: 2.8s;">ğŸ’–</div>
        <div class="heart-blink" style="left: 42%; top: 70%; animation-delay: 0.7s;">ğŸ’•</div>
        <div class="heart-blink" style="left: 58%; top: 80%; animation-delay: 1.9s;">ğŸ’—</div>
        <div class="heart-blink" style="left: 72%; top: 40%; animation-delay: 2.4s;">ğŸ’–</div>
        <div class="heart-blink" style="left: 88%; top: 90%; animation-delay: 0.9s;">ğŸ’•</div>
        <div class="heart-blink" style="left: 5%; top: 50%; animation-delay: 2.1s;">ğŸ’—</div>
        <div class="heart-blink" style="left: 95%; top: 75%; animation-delay: 1.6s;">ğŸ’–</div>
        <div class="heart-blink" style="left: 32%; top: 12%; animation-delay: 2.7s;">ğŸ’•</div>

        <div class="sparkle-element" style="left: 20%; top: 30%; animation-delay: 0.5s;"></div>
        <div class="sparkle-element" style="left: 40%; top: 50%; animation-delay: 1.5s;"></div>
        <div class="sparkle-element" style="left: 60%; top: 70%; animation-delay: 2.5s;"></div>
        <div class="sparkle-element" style="left: 80%; top: 40%; animation-delay: 1s;"></div>
    </div>

    <nav>
        <a href="{% url 'home_calculo' %}">InÃ­cio</a>
        <a href="{% url 'bissecao_calculator' %}">BisseÃ§Ã£o</a>
        <a href="{% url 'newton_calculator' %}">Newton-Raphson</a>
        <a href="{% url 'gauss_calculator' %}">EliminaÃ§Ã£o de Gauss</a>
    </nav>

    <div class="container">
        <img src="{% load static %}{% static 'Barbie_Logo.svg.png' %}" alt="Barbie" class="barbie-logo-small">
        <h1>Calculadora MÃ©todo da BisseÃ§Ã£o</h1>

        <div class="info-box">
            <p><strong>O que este cÃ¡lculo faz:</strong> aplica o mÃ©todo da bisseÃ§Ã£o para encontrar uma raiz real de
                <code>f(x)</code> dentro de um intervalo <code>[a, b]</code>.
            </p>
            <p><strong>Como preencher:</strong></p>
            <ul>
                <li><strong>f(x)</strong>: escreva a funÃ§Ã£o usando <code>x</code> (ex.: <code>x**3 - x - 2</code>).</li>
                <li><strong>Intervalo [a, b]</strong>: escolha valores com sinais opostos para <code>f(a)</code> e
                    <code>f(b)</code> (ex.: <code>a = 1.0</code>, <code>b = 2.0</code>).
                </li>
                <li><strong>TolerÃ¢ncia</strong>: precisÃ£o desejada para a raiz (ex.: <code>1e-5</code>).</li>
                <li><strong>MÃ¡x. iteraÃ§Ãµes</strong>: limite de iteraÃ§Ãµes para interromper o cÃ¡lculo se necessÃ¡rio (ex.:
                    <code>100</code>).
                </li>
            </ul>
            <p><strong>FunÃ§Ãµes suportadas</strong>: <code>sin</code>, <code>cos</code>, <code>exp</code>,
                <code>log</code> (ln), <code>sqrt</code> e operaÃ§Ãµes aritmÃ©ticas. Use <code>**</code> para potÃªncia e
                <code>*</code> para multiplicaÃ§Ã£o.
            </p>
            <p><strong>Exemplo rÃ¡pido:</strong> <code>f(x) = x**3 - x - 2</code>, intervalo <code>[1.0, 2.0]</code>,
                tolerÃ¢ncia <code>1e-5</code>.</p>
        </div>

        <form method="post" novalidate>
            {% csrf_token %}
            <div>
                <label for="funcao_str">f(x):</label>
                <input type="text" id="funcao_str" name="funcao_str"
                    value="{{ form_data.funcao_str|default:'x**3 - x - 2' }}" required>
            </div>
            <div>
                <label for="a_str">a:</label>
                <input type="text" id="a_str" name="a_str" value="{{ form_data.a_str|default:'1.0' }}" required>
            </div>
            <div>
                <label for="b_str">b:</label>
                <input type="text" id="b_str" name="b_str" value="{{ form_data.b_str|default:'2.0' }}" required>
            </div>
            <div>
                <label for="erro_str">Îµ (ex: 0.00001 ou 1e-5):</label>
                <input type="text" id="erro_str" name="erro_str" value="{{ form_data.erro_str|default:'1e-5' }}"
                    required>
            </div>
            <div>
                <label for="max_iter_str">K:</label>
                <input type="number" id="max_iter_str" name="max_iter_str"
                    value="{{ form_data.max_iter_str|default:'100' }}" min="1" step="1" required>
            </div>
            <input type="submit" value="Calcular">
        </form>

        {% if erro_input %}
        <div class="result error">
            <h3>Erro na Entrada de Dados:</h3>
            <p>{{ erro_input }}</p>
        </div>
        {% endif %}

        {% if erro_sympy %}
        <div class="result error">
            <h3>Erro na ExpressÃ£o da FunÃ§Ã£o ou CÃ¡lculo:</h3>
            <p>{{ erro_sympy }}</p>
        </div>
        {% endif %}

        {% if resultado %}
        <div
            class="result {% if resultado.raiz is not None and not erro_input and not erro_sympy %}success{% elif not erro_input and not erro_sympy %}error{% endif %}">
            <h3>Resultado do CÃ¡lculo (BisseÃ§Ã£o):</h3>
            {% if resultado.raiz is not None %}
            <p><strong>Raiz encontrada:</strong> <code>{{ resultado.raiz|stringformat:".10f" }}</code></p>
            <p><strong>f(raiz):</strong> <code>{{ resultado.f_na_raiz|stringformat:".10e" }}</code></p>
            {% if resultado.erro_calculado is not None %}
            <p><strong>Erro relativo:</strong> <code>{{ resultado.erro_calculado|stringformat:".10e" }}</code></p>
            {% endif %}
            {% else %}
            <p><strong>NÃ£o foi possÃ­vel encontrar a raiz com os parÃ¢metros fornecidos.</strong></p>
            {% endif %}
            <p><strong>IteraÃ§Ãµes realizadas:</strong> {{ resultado.iteracoes }}</p>
            <p><strong>Mensagem do sistema:</strong> {{ resultado.mensagem }}</p>
        </div>
        {% endif %}
    </div>

    <!-- Easter Egg fora do container -->
    <img src="{% load static %}{% static 'bixin-barbie.png' %}" alt="Easter Egg" class="easter-egg-creature"
        id="easterEgg" onerror="console.error('Erro ao carregar imagem do easter egg')">

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const submitButton = document.querySelector('input[type="submit"]');
            const easterEgg = document.getElementById('easterEgg');

            console.log('Easter Egg element:', easterEgg);
            console.log('Submit button:', submitButton);

            if (submitButton) {
                submitButton.addEventListener('click', function (e) {
                    console.log('Button clicked! Triggering easter egg...');

                    // Ativar animaÃ§Ã£o estilo "Toasty!" do Mortal Kombat
                    easterEgg.classList.remove('active');
                    void easterEgg.offsetWidth; // Force reflow
                    easterEgg.classList.add('active');

                    console.log('Easter egg class added:', easterEgg.className);

                    // A pÃ¡gina vai recarregar, mas o usuÃ¡rio verÃ¡ o inÃ­cio da animaÃ§Ã£o
                });
            } else {
                console.error('BotÃ£o de submit nÃ£o encontrado!');
            }

            // Salvar no sessionStorage que o easter egg deve aparecer
            if (submitButton) {
                submitButton.addEventListener('click', function () {
                    sessionStorage.setItem('showEasterEgg', 'true');
                });
            }

            // Verificar se deve mostrar o easter egg ao carregar a pÃ¡gina (apÃ³s submit)
            if (sessionStorage.getItem('showEasterEgg') === 'true') {
                sessionStorage.removeItem('showEasterEgg');
                console.log('Mostrando easter egg apÃ³s reload...');

                setTimeout(function () {
                    easterEgg.classList.add('active');
                    setTimeout(function () {
                        easterEgg.classList.remove('active');
                    }, 800);
                }, 100);
            }
        });
    </script>
</body>

</html>